(()=>{fetch("https://script.google.com/macros/s/AKfycbybniugM8wK3-QLOPQ51AJ6jgHrZOfTJ6JSmXDMoT3T8AA3YSLTsVh1893t62zhQTJlFA/exec").then(t=>t.json()).then(({response:t})=>{passports=t,body.classList.remove("loading"),idInput.max=passports.length,currPassportId&&(idInput.value=currPassportId,toHtml(passports[currPassportId-1])),console.log("Паспорта получены")});let passports,currCountry,colorChanging,currPassportId=+location.search.split("id=")[1]||!1,pageFlipping=!1,currLoc=1;const{protocol,host,pathname}=location,BASE_URL=protocol+"//"+host+pathname,FILES_PATH="./files/",$=t=>document.getElementById(t),transformBtns=t=>{prevBtn.style.transform=`translateX(-${t}px)`,nextBtn.style.transform=`translateX(${t}px)`},body=document["body"],[prevBtn,rotateBtn,idBtn,nextBtn]=body.querySelectorAll(".p_btn"),spreads=body.querySelectorAll(".spread"),idForm=$("id-form"),idInput=$("id-input"),book=$("book"),osisLogo=$("osis"),createGetter=r=>({get:(t,e)=>t.querySelector(r+e)}),proxyDOM=t=>new Proxy(t,{set:(t,e,r)=>t[e].textContent=r}),u=new Proxy($("f3"),createGetter("#u_")),mainPage=proxyDOM({name:u.name,flagCont:u["flag-container"],flag:u.flag,country:u.country,photo:u.photo,id:u.id,surname:u.surname,dob:u.DoB,doi:u.DoI,sex:u.sex,nationality:u.nationality,print:u.print}),cah=new Proxy($("country_and_herb"),createGetter("#")),frontCover=proxyDOM({countryName:cah["country-name"],herb:cah.herb}),countries=[["gsld","#332266","Республика Гусляндия","goose.svg"],["ngld","#55bb33","Республика Неогусляндия","goose.svg"],["duck","#ee8844","Утиное Государство","duck.png"]].map(t=>({dir:FILES_PATH+t[0]+"/",code:t[0],color:t[1],name:t[2],standardImage:FILES_PATH+"standard-image/"+t[3]}));for(let t=0;t<spreads.length;t++)spreads[t].style.zIndex=spreads.length-t,spreads[t].querySelector(".paper")&&(spreads[t].style.visibility="hidden");body.style.setProperty("--p_color","#999999");const maxLoc=spreads.length+1,pageHandler=(book.addEventListener("click",({target:t})=>{t.closest(".back")?goPage(!1):t.closest("#copy")?currPassportId&&navigator.clipboard.writeText(location.href):goPage(!0)}),t=>goPage(t.target===nextBtn)),keyEvents=(prevBtn.addEventListener("click",pageHandler),nextBtn.addEventListener("click",pageHandler),rotateBtn.addEventListener("click",rotateBook),idBtn.addEventListener("click",getPassport),{ArrowRight(){goPage(!0)},ArrowLeft(){goPage(!1)}});function getPassport(){var t=idInput["value"];0<t&&t!=currPassportId&&(currPassportId=t,history.pushState({id:currPassportId},null,BASE_URL+"?id="+currPassportId),toHtml(passports[currPassportId-1]))}function toHtml(t){const[e,r,o,n,s,a,i,l,c,d,p]=t,u=countries[n];var g;currCountry!==u&&(t={[u.code.toUpperCase()]:!0},g=u.dir+"/herb.svg",frontCover.countryName.style.fontSize=(t.NGLD?"20":"24")+"px",frontCover.countryName=u.name,frontCover.herb.src=g,changeColor(getComputedStyle(body).getPropertyValue("--p_color"),u.color),book.style.setProperty("--herb_url",`url(${g})`),currCountry=u,mainPage.flagCont.style=t.DUCK?"text-align: center; background: #8ce; width: 80%":"text-align: none; background: none; width: none",Object.assign(mainPage.flag,{src:t.DUCK?g:u.dir+"/flag.svg",style:"float: "+(t.DUCK?"none":"left")}),mainPage.country=u.name),mainPage.photo.src=c||u.standardImage,Object.assign(mainPage,{name:e,id:a,surname:r,dob:i,sex:o,nationality:s,doi:l});const y=mainPage["print"];switch(d){case 1:"Аннулировано"===y.textContent&&(y.innerHTML=osisLogo),Object.assign(y.style,{visibility:"visible",width:"130px",transform:"rotate(-90deg) translate(100%, 400%)"});break;case-1:y.textContent="Аннулировано",Object.assign(y.style,{visibility:"visible",width:"90%",transform:"rotate(-90deg) translateY(200%)"});break;default:y.style.visibility="hidden"}const m=document.getElementById("marriages");if(m.innerHTML="",p)for(let t=0;t<p.length;t++){const[b,e,f]=p[t];m.innerHTML+=`
			<div class='card'>
				<div class='data'>
					<span>${e}</span>
					<span class='date'>${b}</span>
				</div>
				${f?`<div class='divorce'> Расторгнут ${f} </div>`:""}
			</div>
		`}}function changeColor(t,e,r=1e3,o=60){clearInterval(colorChanging);var n=t=>[parseInt(t[1]+t[2],16),parseInt(t[3]+t[4],16),parseInt(t[5]+t[6],16)];const s=n(t);n=n(e);const a=[(s[0]-n[0])/o,(s[1]-n[1])/o,(s[2]-n[2])/o],i=Math["round"];colorChanging=setInterval(()=>{t="#"+i(s[0]-=a[0]).toString(16)+i(s[1]-=a[1]).toString(16)+i(s[2]-=a[2]).toString(16),body.style.setProperty("--p_color",t),t===e&&clearInterval(colorChanging)},r/o)}document.addEventListener("keydown",({key:t})=>{getSelection().anchorNode!==idForm&&(+t?idInput.select():keyEvents[t]?.())}),idInput.addEventListener("keydown",t=>"Enter"===t.key&&getPassport()),idInput.addEventListener("input",({target:t})=>{t.value=+t.value>t.max?t.max:t.value.replace(/^[-0]+/g,"")}),onpopstate=({state:t})=>{t=t?.id||!1;t?(idInput.value=currPassportId=t,toHtml(passports[t-1])):location.reload()},mainPage.photo.onerror=({target:t})=>t.src=currCountry.standardImage;const setSpreadsVisibility=e=>{for(let t=0;t<spreads.length;t++)spreads[t].querySelector(".paper")&&(spreads[t].style.visibility=e)};function openBook(){book.style.transform="translateX(50%)",transformBtns(180),prevBtn.style.visibility=nextBtn.style.visibility="visible",prevBtn.style.opacity=nextBtn.style.opacity=100,setSpreadsVisibility("visible")}function closeBook(){let t;(t=2===currLoc?(book.style.transform="translateX(0)",prevBtn):(book.style.transform="translateX(100%)",nextBtn)).style.opacity=0,setTimeout(()=>{"0"===t.style.opacity&&(t.style.visibility="hidden"),setSpreadsVisibility("hidden")},250),transformBtns(0)}function goPage(s){if(!pageFlipping)if("boolean"!=typeof s){if(isNaN(s))return;s=+s;var a=2*maxLoc-5;s<1?s=-1:a<s&&(s=1+a);let t=2*currLoc-3;const e=t<s,r=setInterval(()=>{s!==t&&s!==t-1||clearInterval(r),goPage(e),t+=e?2:-2},270)}else{let t,e,r,o,n;if(s){if(currLoc===maxLoc)return;e="b2",r=()=>currLoc-spreads.length,o=()=>currLoc++,n=[openBook,closeBook]}else{if(1===currLoc)return;e="f4",r=()=>spreads.length-t,o=()=>currLoc--,n=[closeBook,openBook]}pageFlipping=!0;a=+s;t=currLoc+a-2;const i=spreads[t],l=(t?currLoc===maxLoc-a&&n[1]():n[0](),i.classList.toggle("flipped"),i.querySelector("#f4")||i.querySelector("#b2"));if(l){const c=l.querySelector(".paper"),d=(c.style.boxShadow="none",l.id);d===e&&setTimeout(()=>{var t="b2"===d;c.style.boxShadow=(t?"-":"")+"5px 0 5px #0005"},250)}setTimeout(()=>{i.style.zIndex=i.querySelector(".front").style.zIndex=r()},250*a),setTimeout(()=>pageFlipping=!1,250),o()}}function rotateBook(){var t=currLoc===maxLoc,e=1===currLoc;-1===book.style.transform.indexOf("rotate")?(book.style.transform=`rotate(90deg) translateX(${t?120:20}%)`,transformBtns(80)):(book.style.transform=`translateX(${e?0:t?100:50}%)`,transformBtns(e||t?0:180))}})()