(()=>{fetch("https://script.google.com/macros/s/AKfycbybniugM8wK3-QLOPQ51AJ6jgHrZOfTJ6JSmXDMoT3T8AA3YSLTsVh1893t62zhQTJlFA/exec").then(t=>t.json()).then(({response:t})=>{passports=t,body.classList.remove("loading"),idInput.max=passports.length,currPassportId&&(idInput.value=currPassportId,doQRColorTransition=!1,toHtml(passports[currPassportId-1])),console.log("Passports have been loaded")});let passports,currCountry,colorChanging,doQRColorTransition,currPassportId=+location.search.split("id=")[1]||null,currLoc=1;const{protocol,host,pathname}=location,BASE_URL=protocol+"//"+host+pathname,FILES_PATH="./files/",DEFAULT_COLOR="rgb(135, 135, 135)",getPassportUrl=t=>BASE_URL+(t?"?id="+t:""),assign=Object["assign"],$=t=>document.getElementById(t),transformBtns=t=>{prevBtn.style.transform=`translateX(-${t}px)`,nextBtn.style.transform=`translateX(${t}px)`},bookTranslateX=t=>{book.style.transform=`translateX(${t})`},body=document["body"],spreads=Array.from(body.querySelectorAll(".spread")),rotateBtn=$("rotate-btn"),prevBtn=$("prev"),nextBtn=$("next"),idBtn=$("id-btn"),idForm=$("id-form"),idInput=$("id-input"),book=$("book"),countryCode=document.getElementById("country-code"),proxyDOM=(t,o,e)=>new Proxy(e(new Proxy($(t),{get:(t,e)=>t.querySelector(o+e)})),{set:(t,e,o)=>t[e].textContent=o}),mainPage=proxyDOM("f3","#u_",t=>({name:t.name,flagCont:t["flag-container"],flag:t.flag,country:t.country,photo:t.photo,id:t.id,surname:t.surname,dob:t.DoB,doi:t.DoI,sex:t.sex,nationality:t.nationality,stamp:assign(t.stamp,{_codes:{"-1":["null","Аннулировано"],0:["no",""],1:["normal",$("osis").innerHTML]},setStatus(t){var[t,e]=this._codes[t]||this._codes[0];assign(this,{className:t,innerHTML:e})}})})),frontCover=proxyDOM("country_and_herb","#",t=>({countryName:t["country-name"],herb:t.herb})),countries=[["gsld","326","Республика Гусляндия","goose.svg"],["ngld","5b3","Республика Неогусляндия","goose.svg"],["duck","e84","Утиное Государство","duck.png"]].map(([t,e,o,r])=>({code:t,name:o,color:e.match(/./g).map(t=>parseInt(t+t,16)),standardImage:FILES_PATH+"standard-image/"+r})),qr=assign(new QRCode($("qr"),{text:getPassportUrl(currPassportId),width:256,height:256,colorDark:DEFAULT_COLOR,colorLight:"#0000",correctLevel:QRCode.CorrectLevel.L}),{startColorChanging(){this._oDrawing._elCanvas.style.display="unset",this._oDrawing._elImage.style.display="none"},changeColor(t){this._htOption.colorDark=t,this._oDrawing.draw(this._oQRCode)},stopColorChanging(){this.makeImage()}});for(let t=0;t<spreads.length;t++)spreads[t].style.zIndex=spreads.length-t;body.style.setProperty("--p_color",DEFAULT_COLOR);const[lSpread,plSpread]=spreads.reverse(),[fSpread,sSpread]=spreads.reverse(),maxLoc=(fSpread.isCover=fSpread.isFirst=lSpread.isCover=sSpread.isFirst=!0,spreads.length+1);function getPassport(){var t,e=+idInput.value;0<e&&e!==currPassportId&&(currPassportId=e,t=getPassportUrl(e),history.pushState({id:e},null,t),qr.makeCode(t),toHtml(passports[e-1]))}function toHtml(t){const[e,o,r,n,s,a,i,l,c,d,p]=t,g=countries[n];book.dataset.code=g.code,currCountry!==g&&(book.className="",g.code.toUpperCase(),frontCover.countryName=g.name,changeColor(getComputedStyle(body).getPropertyValue("--p_color"),g.color),currCountry=g,mainPage.country=g.name),mainPage.photo.src=c||g.standardImage,assign(mainPage,{name:e,id:a,surname:o,dob:i,sex:r,nationality:s,doi:l}),mainPage.stamp.setStatus(d);const u=document.getElementById("marriages");if(u.innerHTML="",p)for(let t=0;t<p.length;t++){const[m,e,y]=p[t];u.innerHTML+=`
		<div class='card'>
			<div class='data'>
				<span>${e}</span>
				<span class='date'>${m}</span>
			</div>
			${y?`<div class='divorce'> Расторгнут ${y} </div>`:""}
		</div>`}}function changeColor(t,e,o=1e3,r=60){clearInterval(colorChanging);const n=t.match(/\d+/g).map(Number),s=Array(3);for(let t=0;t<3;t++)s[t]=(n[t]-e[t])/r;const a=`rgb(${e})`;qr.startColorChanging();let i,l;l=doQRColorTransition?(i=()=>qr.changeColor(t),()=>qr.stopColorChanging()):(qr.changeColor(a),qr.stopColorChanging(),i=()=>{},()=>doQRColorTransition=!0),colorChanging=setInterval(()=>{for(let t=0;t<3;t++)n[t]-=s[t];t=`rgb(${n.map(t=>Math.round(t))})`,body.style.setProperty("--p_color",t),i(),t===a&&(l(),clearInterval(colorChanging))},o/r)}function openBook(){bookTranslateX("50%"),transformBtns(180),prevBtn.style.visibility=nextBtn.style.visibility="visible",prevBtn.style.opacity=nextBtn.style.opacity=100}function closeBook(){let t;(t=2===currLoc?(bookTranslateX("0"),prevBtn):(bookTranslateX("100%"),nextBtn)).style.opacity=0,setTimeout(()=>{"0"===t.style.opacity&&(t.style.visibility="hidden")},250),transformBtns(0)}onpopstate=({state:t})=>{t=t?.id||!1;t?(idInput.value=currPassportId=t,toHtml(passports[t-1])):location.reload()};const pageController={_isFlipping:!(mainPage.photo.onerror=({target:t})=>t.src=currCountry.standardImage),_nextParams:{getIndex:()=>currLoc-spreads.length,handleBook:[openBook,closeBook]},_prevParams:{getIndex:()=>spreads.length-i,handleBook:[closeBook,openBook]},next(){currLoc!==maxLoc&&this._flip(!0,this._nextParams)&&currLoc++},prev(){1!==currLoc&&this._flip(!1,this._prevParams)&&currLoc--},_flip(t,{handleBook:e,getIndex:o}){if(this._isFlipping)return!1;this._isFlipping=!0,i=currLoc+t-2;const r=spreads[i];var{isCover:n,isFirst:s}=r;return r.classList.toggle("flipped"),n&&(s?e[0]():e[1]()),setTimeout(()=>{r.style.zIndex=r.querySelector(".front").style.zIndex=o()},250*t),setTimeout(()=>{this._isFlipping=!1},250),!0}};function rotateBook(){var t=currLoc===maxLoc,e=1===currLoc;~book.style.transform.indexOf("rotate")?(bookTranslateX((e?0:t?100:50)+"%"),transformBtns(e||t?0:180)):(book.style.transform=`rotate(90deg) translateX(${t?120:20}%)`,transformBtns(80))}book.addEventListener("click",({target:t})=>{t.closest("#qr")?navigator.clipboard.writeText(location.href):t.closest(".front")?pageController.next():pageController.prev()}),prevBtn.addEventListener("click",()=>pageController.prev()),nextBtn.addEventListener("click",()=>pageController.next()),rotateBtn.addEventListener("click",rotateBook),idBtn.addEventListener("click",getPassport);const keyEvents={ArrowRight(){pageController.next()},ArrowLeft(){pageController.prev()}};document.addEventListener("keydown",({key:t})=>{getSelection().anchorNode!==idForm&&(+t?idInput.select():keyEvents[t]?.())}),idInput.addEventListener("keydown",t=>"Enter"===t.key&&getPassport()),idInput.addEventListener("input",({target:t})=>{t.value=+t.value>t.max?t.max:t.value.replace(/^[-0]+/g,"")});})()